<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Portal de Documentos ‚Äì Tramontina</title>

  <style>
    :root{
      --blue:#003087;
      --blue2:#1f5fe0;
      --bg:#f4f6fb;
      --ink:#0b1220;
      --muted:#5b6b85;
      --card:#ffffff;
      --radius:16px;
      --shadow:0 12px 26px rgba(0,0,0,.14);
      --wa:#22c55e;
      --line: rgba(0,0,0,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(900px 420px at 20% -10%, rgba(31,95,224,.18), transparent 55%),
        radial-gradient(800px 420px at 90% 0%, rgba(0,48,135,.12), transparent 55%),
        linear-gradient(180deg,#fff,var(--bg));
      color:var(--ink);
    }

    header{
      position:sticky;top:0;z-index:100;
      background:linear-gradient(90deg,var(--blue),var(--blue2));
      color:#fff;
      border-bottom:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(10px);
    }
    .header-inner{max-width:1100px;margin:auto;padding:14px 16px}
    .header-top{display:flex;align-items:center;gap:12px}
    .header-top img{height:34px; width:auto; display:block}
    .header-title{font-size:18px;font-weight:900}

    .search{margin-top:12px}
    .search input{
      width:100%;padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.20);
      background:rgba(255,255,255,.14);color:#fff;
      outline:none;
    }
    .search input::placeholder{color:#e6ecff}

    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .tab{
      background:rgba(255,255,255,.15);
      border:1px solid rgba(255,255,255,.25);
      color:#fff;
      padding:10px 14px;
      border-radius:14px;
      font-weight:850;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{background:rgba(255,255,255,.28)}

    .subtabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:center;
      margin: 14px auto 0;
      max-width:1100px;
      padding: 0 16px;
    }
    .subtab{
      background:#fff;
      border:1px solid var(--line);
      color:var(--ink);
      padding:9px 12px;
      border-radius:14px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 10px 22px rgba(0,0,0,.08);
    }
    .subtab.active{
      background: rgba(0,48,135,.10);
      border-color: rgba(0,48,135,.22);
    }

    .hero{
      max-width:1100px;
      margin:22px auto 8px;
      padding:0 16px;
      text-align:center;
    }
    .hero img{height:64px;margin-bottom:10px; width:auto}
    .hero h2{margin:0;font-size:22px;font-weight:900}
    .hero p{margin:6px 0 0;color:var(--muted)}

    /* ===== VISTA: barra de categoria (mais visual) ===== */
    .catbar{
      max-width:1100px;
      margin: 10px auto 0;
      padding: 0 16px;
      display:flex;
      justify-content:center;
    }
    .catbar-inner{
      width: min(820px, 100%);
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 12px 26px rgba(0,0,0,.10);
      border-radius: 18px;
      padding: 10px 12px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:center;
    }
    .catbar-tag{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,48,135,.10);
      border: 1px solid rgba(0,48,135,.18);
      font-weight: 950;
      font-size: 14px;
      color: var(--ink);
    }
    .catbar-tag .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--blue);
      box-shadow: 0 0 0 4px rgba(0,48,135,.10);
    }
    .catbar-help{
      font-size: 12px;
      color: var(--muted);
    }

    main{max-width:1100px;margin:auto;padding:16px}

    .section{
      background: rgba(255,255,255,.82);
      border:1px solid rgba(0,0,0,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      margin-bottom: 16px;
    }
    .section-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      background: rgba(255,255,255,.65);
    }
    .section-head h3{margin:0;font-size:16px;font-weight:950}
    .count{font-size:12px;color:var(--muted);white-space:nowrap}

    .grid{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:14px;
      padding: 14px;
    }
    .card{
      grid-column:span 12;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow: 0 10px 20px rgba(0,0,0,.10);
      border:1px solid rgba(0,0,0,.06);
      padding:16px;
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    @media(min-width:760px){.card{grid-column:span 6}}
    @media(min-width:1050px){.card{grid-column:span 4}}

    .icon{
      width:42px;height:42px;border-radius:14px;
      display:grid;place-items:center;
      background: rgba(0,48,135,.10);
      border: 1px solid rgba(0,48,135,.18);
      flex:0 0 auto;
      font-size:18px;
    }
    .meta{flex:1;min-width:0}
    .meta h4{
      margin:0 0 6px;
      font-size:14px;
      font-weight:950;
      line-height:1.25;
      word-break: break-word;
    }
    .meta small{color:var(--muted)}
    .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      display:inline-flex;
      justify-content:center;
      align-items:center;
      padding:10px 14px;
      border-radius:14px;
      border:0;
      font-weight:950;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
      min-width: 120px;
    }
    .btn.primary{background:var(--blue);color:#fff}
    .btn.wa{background:var(--wa);color:#fff}
    .btn.info{background:var(--blue2);color:#fff}
    .btn.secondary{background: rgba(0,0,0,.06); color: var(--ink); border:1px solid rgba(0,0,0,.10);}

    .overlay{
      position:fixed;inset:0;display:none;
      background:rgba(0,0,0,.5);
      justify-content:center;align-items:center;
      z-index:200;
      padding: 14px;
    }
    .modal{
      width:min(1100px,100%);
      height:86vh;
      background:#fff;
      border-radius:18px;
      display:flex;
      flex-direction:column;
      overflow:hidden;
      box-shadow: var(--shadow);
    }
    .modal-head{
      background:linear-gradient(90deg,var(--blue),var(--blue2));
      color:#fff;
      padding:12px 14px;
      font-weight:950;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
    }
    .modal-title{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      font-size: 13px;
    }
    .modal-body{flex:1}
    .modal-body iframe{width:100%;height:100%;border:0}

    .contact-overlay{
      position:fixed;inset:0;display:none;
      background:rgba(0,0,0,.5);
      justify-content:center;align-items:center;
      z-index:210;
      padding: 14px;
    }
    .contact-modal{
      background:#fff;
      border-radius:16px;
      width:min(560px,100%);
      box-shadow:var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.08);
    }
    .contact-modal .h{
      background:linear-gradient(90deg,var(--blue),var(--blue2));
      color:#fff;padding:14px;font-weight:950;
    }
    .contact-modal .b{padding:14px;line-height:1.5}
    .contact-modal .f{padding:14px;border-top:1px solid rgba(0,0,0,.08)}
    .contact-modal .f button{width:100%}

    .empty{
      padding: 18px;
      color: var(--muted);
      text-align:center;
    }
  </style>
</head>

<body>
<header>
  <div class="header-inner">
    <div class="header-top">
      <img src="assets/logo_tramontina.png" alt="Tramontina">
      <div class="header-title">Portal de Documentos</div>
    </div>

    <div class="search">
      <input id="q" placeholder="Buscar por nome...">
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="vista">Vista Explodida</button>
      <button class="tab" data-tab="boletins">Boletins</button>
      <button class="tab" data-tab="canais">Canais</button>
    </div>
  </div>
</header>

<div id="hero" class="hero"></div>

<div id="vistaLinhas" class="subtabs" style="display:none"></div>

<div id="vistaCatbar" class="catbar" style="display:none">
  <div class="catbar-inner">
    <div class="catbar-tag">
      <span class="dot"></span>
      <span id="vistaCatLabel">Categoria</span>
    </div>
    <div class="catbar-help">Selecione uma categoria abaixo</div>
  </div>
</div>

<div id="vistaCategorias" class="subtabs" style="display:none"></div>

<div id="boletinsSubtabs" class="subtabs" style="display:none">
  <button class="subtab active" data-sub="tecnicos">Boletins T√©cnicos</button>
  <button class="subtab" data-sub="mao">Boletins M√£o de Obra</button>
</div>

<main id="content"></main>

<div id="pdfOverlay" class="overlay" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="modal-head">
      <div id="pdfTitle" class="modal-title">Visualizar PDF</div>
      <button class="btn secondary" onclick="closePdf()">Fechar</button>
    </div>
    <div class="modal-body">
      <iframe id="pdfFrame" title="Visualizador de PDF"></iframe>
    </div>
  </div>
</div>

<div id="contactOverlay" class="contact-overlay" role="dialog" aria-modal="true">
  <div class="contact-modal">
    <div class="h">Informa√ß√µes de Contato</div>
    <div class="b" id="contactBody"></div>
    <div class="f">
      <button class="btn primary" onclick="closeContact()">Fechar</button>
    </div>
  </div>
</div>

<script>
const OWNER="danielzavalhia-commits";
const REPO="dani2";
const BRANCH="main";

/* ====== CONFIG ====== */
const VISTA_BASE = "vista_explodida";

const VISTA_LINHAS = [
  { key:"Am√©rica", label:"Am√©rica" },
  { key:"Europa", label:"Europa" },
  { key:"Refrigera√ß√£o", label:"Refrigera√ß√£o" },
  { key:"Neutros", label:"Neutros" }
];

const BOLETINS_TECNICOS_ROOT = "boletins/tecnicos";
const BOLETINS_MAO_ROOT = "boletins/mao_de_obra";

const HERO_TEXT = {
  vista: { title:"Vista Explodida", desc:"Selecione a linha e a categoria para visualizar os PDFs de pe√ßas." },
  boletins: { title:"Boletins", desc:"Selecione o tipo de boletim para visualizar os PDFs atualizados automaticamente." },
  canais: { title:"Canais de Atendimento ‚Äì Tramontina Profissional | Farroupilha", desc:"Ordens de Servi√ßo ‚Ä¢ Suporte T√©cnico ‚Ä¢ Promotores T√©cnicos" }
};
const BOLETINS_SUB_TEXT = {
  tecnicos: { title: "Boletins T√©cnicos", desc: "Boletins t√©cnicos para suporte e orienta√ß√µes." },
  mao: { title: "Boletins M√£o de Obra", desc: "Boletins voltados a m√£o de obra e procedimentos." }
};

const CANAIS = [
  { nome:"Tha√≠s", funcao:"Atendimento ‚Äì Abertura de OS (Manuten√ß√£o)", email:"atendimentocozinhas.far@tramontina.com", tel:"+55 (54) 98153-6033", wa:"https://wa.me/5554981536033" },
  { nome:"Adalberto", funcao:"Suporte T√©cnico ‚Äì OS (Manuten√ß√£o)", email:"adalberto.souto@tramontina.com", tel:"+55 (54) 99243-7971", wa:"https://wa.me/5554992437971" },
  { nome:"Patr√≠cia", funcao:"Atendimento ‚Äì OS (Instala√ß√£o)", email:"atendimentocozinhas.far@tramontina.com", tel:"+55 (54) 99140-5949", wa:"https://wa.me/5554991405949" },
  { nome:"Mauricio", funcao:"Suporte T√©cnico ‚Äì OS (Instala√ß√£o)", email:"mauricio.lima@tramontina.com", tel:"+55 (54) 99205-7821", wa:"https://wa.me/5554992057821" },
  { nome:"Lucas", funcao:"Promotor T√©cnico ‚Äì Regi√µes Sudeste e Nordeste", email:"lucas.bin@tramontina.com", tel:"+55 (54) 98153-6011", wa:"https://wa.me/5554981536011" },
  { nome:"Rafael", funcao:"Promotor T√©cnico ‚Äì Regi√µes Sul, Centro-Oeste e Norte", email:"rafael.silva@tramontina.com", tel:"+55 (54) 99101-2025", wa:"https://wa.me/5554991012025" },
  { nome:"Robson", funcao:"Suporte T√©cnico ‚Äì S√£o Paulo (SP)", email:"robson.menezes@tramontina.com", tel:"+55 (11) 96171-8289", wa:"https://wa.me/5511961718289" },
  { nome:"Josu√©", funcao:"Promotor T√©cnico ‚Äì S√£o Paulo (SP)", email:"josue.rocha@tramontina.com", tel:"+55 (11) 91499-5839", wa:"https://wa.me/5511914995839" }
];

/* ====== UI ====== */
const hero = document.getElementById("hero");
const content = document.getElementById("content");
const q = document.getElementById("q");
const tabs = [...document.querySelectorAll(".tab")];

const vistaLinhasEl = document.getElementById("vistaLinhas");
const vistaCatsEl = document.getElementById("vistaCategorias");
const boletinsSubtabs = document.getElementById("boletinsSubtabs");
const vistaCatbar = document.getElementById("vistaCatbar");
const vistaCatLabel = document.getElementById("vistaCatLabel");

let activeTab = "vista";
let activeBoletimSub = "tecnicos";

let activeVistaLinha = VISTA_LINHAS[0].key;
let activeVistaCat = ""; // "" = Geral

function isPdf(p){ return (p||"").toLowerCase().endsWith(".pdf"); }
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#39;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}
function prettifyName(s){
  return String(s)
    .replace(/[_-]+/g," ")
    .replace(/\s+/g," ")
    .trim()
    .replace(/\b\w/g, c=>c.toUpperCase());
}
function prettifyPath(path){
  const name = path.split("/").pop() || path;
  const base = name.replace(/\.[^/.]+$/, "");
  return prettifyName(base);
}
function pageHrefFor(filePath){
  return new URL(filePath.replace(/^\/+/,""), window.location.href).href;
}

/* ======= MATCH ‚ÄúTOLERANTE‚Äù (ignora acento e mai√∫scula) ======= */
function normPath(s){
  return String(s)
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g,"")
    .toLowerCase();
}
function startsWithFolderLoose(filePath, folderRoot){
  const a = normPath(filePath.replace(/^\/+/,""));
  const b = normPath(folderRoot.replace(/^\/+/,"").replace(/\/+$/,""));
  return a === b || a.startsWith(b + "/");
}

/** Tree cache */
let TREE = null;
async function getBranchSha(){
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/branches/${BRANCH}`;
  const res = await fetch(url, { headers: { "Accept":"application/vnd.github+json" }});
  if(!res.ok) throw new Error(`N√£o consegui ler a branch ${BRANCH} (HTTP ${res.status}).`);
  const data = await res.json();
  return data?.commit?.sha;
}
async function getRepoTree(){
  if(TREE) return TREE;
  const sha = await getBranchSha();
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/git/trees/${sha}?recursive=1`;
  const res = await fetch(url, { headers: { "Accept":"application/vnd.github+json" }});
  if(!res.ok) throw new Error(`N√£o consegui listar os arquivos (HTTP ${res.status}).`);
  const data = await res.json();
  TREE = (data.tree || []).map(x => ({ path:x.path, type:x.type }));
  return TREE;
}

/** PDF modal (VISUALIZAR SEM BAIXAR) */
function openPdf(title, url){
  document.getElementById("pdfTitle").textContent = title;

  // 1) for√ßa visualiza√ß√£o via Google Viewer (mais confi√°vel)
  const viewer = "https://docs.google.com/gview?embedded=1&url=" + encodeURIComponent(url);
  document.getElementById("pdfFrame").src = viewer;

  document.getElementById("pdfOverlay").style.display = "flex";
}
function closePdf(){
  document.getElementById("pdfOverlay").style.display = "none";
  document.getElementById("pdfFrame").src = "";
}
document.getElementById("pdfOverlay").addEventListener("click", (e)=>{
  if(e.target.id === "pdfOverlay") closePdf();
});

/** Contato modal */
function showContactFromButton(btn){
  const nome = btn.dataset.nome;
  const funcao = btn.dataset.funcao;
  const email = btn.dataset.email;
  const tel = btn.dataset.tel;

  document.getElementById("contactBody").innerHTML =
    `<b>Nome:</b> ${escapeHtml(nome)}<br>
     <b>Fun√ß√£o:</b> ${escapeHtml(funcao)}<br>
     <b>E-mail:</b> ${escapeHtml(email)}<br>
     <b>Telefone:</b> ${escapeHtml(tel)}`;

  document.getElementById("contactOverlay").style.display = "flex";
}
function closeContact(){ document.getElementById("contactOverlay").style.display = "none"; }
document.getElementById("contactOverlay").addEventListener("click",(e)=>{ if(e.target.id==="contactOverlay") closeContact(); });
document.addEventListener("keydown",(e)=>{ if(e.key==="Escape"){ closePdf(); closeContact(); } });

/** UI shell */
function setHero(){
  const isVista = activeTab === "vista";
  const isBoletins = activeTab === "boletins";

  boletinsSubtabs.style.display = isBoletins ? "flex" : "none";
  vistaLinhasEl.style.display = isVista ? "flex" : "none";
  vistaCatsEl.style.display   = isVista ? "flex" : "none";
  vistaCatbar.style.display   = isVista ? "flex" : "none";

  if(activeTab==="boletins"){
    const sub = BOLETINS_SUB_TEXT[activeBoletimSub];
    hero.innerHTML = `
      <img src="assets/logo_tramontina.png" alt="Tramontina">
      <h2>${escapeHtml(sub.title)}</h2>
      <p>${escapeHtml(sub.desc)}</p>
    `;
  } else {
    const h = HERO_TEXT[activeTab];
    hero.innerHTML = `
      <img src="assets/logo_tramontina.png" alt="Tramontina">
      <h2>${escapeHtml(h.title)}</h2>
      <p>${escapeHtml(h.desc)}</p>
    `;
  }
}

function sectionShell(title, countText, innerHtml){
  return `
    <section class="section">
      <div class="section-head">
        <h3>${escapeHtml(title)}</h3>
        <div class="count">${countText || ""}</div>
      </div>
      ${innerHtml}
    </section>
  `;
}

function pdfCard(filePath){
  const title = prettifyPath(filePath);
  const url = pageHrefFor(filePath);
  return `
    <div class="card">
      <div class="icon">üìÑ</div>
      <div class="meta">
        <h4>${escapeHtml(title)}</h4>
        <small>PDF</small>
        <div class="actions">
          <button class="btn primary" onclick="openPdf(${JSON.stringify(title)}, ${JSON.stringify(url)})">Visualizar</button>
        </div>
      </div>
    </div>
  `;
}

/** ===== Vista Explodida: categorias por PDFs ===== */
function listCategoriasFromPdfs(allPdfPaths, linhaRoot){
  const prefixNorm = normPath(linhaRoot.replace(/\/+$/,"") + "/");
  const cats = new Set();
  let hasGeral = false;

  for(const p of allPdfPaths){
    const pNorm = normPath(p);
    if(!pNorm.startsWith(prefixNorm)) continue;

    const restNorm = pNorm.slice(prefixNorm.length);
    if(!restNorm) continue;

    const partsNorm = restNorm.split("/");

    // PDF direto na raiz da linha => Geral
    if(partsNorm.length === 1){
      hasGeral = true;
      continue;
    }

    // categoria = primeira subpasta (pega nome original do caminho real)
    const originalPrefix = (linhaRoot.replace(/\/+$/,"") + "/");
    const originalRest = p.slice(originalPrefix.length);
    const originalParts = originalRest.split("/");
    cats.add(originalParts[0]);
  }

  const list = [...cats].sort((a,b)=>a.localeCompare(b,"pt-BR"));
  return { list, hasGeral };
}

function renderVistaLinhasTabs(){
  vistaLinhasEl.innerHTML = VISTA_LINHAS.map(l => `
    <button class="subtab ${l.key===activeVistaLinha ? "active":""}" data-linha="${escapeHtml(l.key)}">
      ${escapeHtml(l.label)}
    </button>
  `).join("");

  vistaLinhasEl.querySelectorAll(".subtab").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      vistaLinhasEl.querySelectorAll(".subtab").forEach(x=>x.classList.remove("active"));
      btn.classList.add("active");
      activeVistaLinha = btn.dataset.linha;
      activeVistaCat = ""; // volta para Geral
      render();
    });
  });
}

function renderVistaCategoriasTabs(cats, hasGeral){
  const items = [];
  if(hasGeral) items.push({key:"", label:"Geral"});
  cats.forEach(c => items.push({key:c, label: prettifyName(c)}));

  vistaCatsEl.innerHTML = items.map(it=>`
    <button class="subtab ${it.key===activeVistaCat ? "active":""}" data-cat="${escapeHtml(it.key)}">
      ${escapeHtml(it.label)}
    </button>
  `).join("");

  vistaCatsEl.querySelectorAll(".subtab").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      vistaCatsEl.querySelectorAll(".subtab").forEach(x=>x.classList.remove("active"));
      btn.classList.add("active");
      activeVistaCat = btn.dataset.cat || "";
      render();
    });
  });

  // se a categoria ativa n√£o existir mais, volta pra primeira
  const exists = items.some(it=>it.key===activeVistaCat);
  if(!exists && items.length) activeVistaCat = items[0].key;
}

function canaisView(query){
  const filtered = CANAIS.filter(c=>{
    if(!query) return true;
    return (c.nome + " " + c.funcao + " " + c.email).toLowerCase().includes(query);
  });

  return sectionShell(
    "Canais de Atendimento",
    `${filtered.length} contato(s)`,
    `
      <div class="grid">
        ${filtered.map(c => `
          <div class="card">
            <div class="icon">üë§</div>
            <div class="meta">
              <h4>${escapeHtml(c.nome)}</h4>
              <small>${escapeHtml(c.funcao)}<br><b>E-mail:</b> ${escapeHtml(c.email)}</small>
              <div class="actions">
                <a class="btn wa" target="_blank" rel="noopener" href="${c.wa}">WhatsApp</a>
                <button
                  class="btn info"
                  data-nome="${escapeHtml(c.nome)}"
                  data-funcao="${escapeHtml(c.funcao)}"
                  data-email="${escapeHtml(c.email)}"
                  data-tel="${escapeHtml(c.tel)}"
                  onclick="showContactFromButton(this)"
                >Mostrar contato</button>
              </div>
            </div>
          </div>
        `).join("")}
      </div>
    `
  );
}

async function render(){
  const query = (q.value || "").trim().toLowerCase();
  setHero();

  if(activeTab === "canais"){
    content.innerHTML = canaisView(query);
    return;
  }

  let treeItems = [];
  try{
    treeItems = await getRepoTree();
  }catch(e){
    content.innerHTML = sectionShell("Erro","",`<div class="empty">${escapeHtml(e.message || String(e))}</div>`);
    return;
  }

  const allPdfPaths = treeItems
    .filter(x => x.type==="blob" && isPdf(x.path))
    .map(x => x.path);

  // BOLETINS
  if(activeTab === "boletins"){
    const root = (activeBoletimSub === "tecnicos") ? BOLETINS_TECNICOS_ROOT : BOLETINS_MAO_ROOT;
    const label = (activeBoletimSub === "tecnicos") ? "Boletins T√©cnicos" : "Boletins M√£o de Obra";

    let files = allPdfPaths.filter(p => startsWithFolderLoose(p, root));
    if(query) files = files.filter(p => normPath(p).includes(normPath(query)));
    files.sort((a,b)=>a.localeCompare(b,"pt-BR"));

    content.innerHTML = sectionShell(
      label,
      `${files.length} arquivo(s)`,
      files.length ? `<div class="grid">${files.map(pdfCard).join("")}</div>`
                   : `<div class="empty">Nenhum PDF encontrado em <b>/${escapeHtml(root)}</b>.</div>`
    );
    return;
  }

  // VISTA EXPLODIDA
  if(activeTab === "vista"){
    renderVistaLinhasTabs();

    const linhaRoot = `${VISTA_BASE}/${activeVistaLinha}`;

    const { list:cats, hasGeral } = listCategoriasFromPdfs(allPdfPaths, linhaRoot);
    renderVistaCategoriasTabs(cats, hasGeral);

    // Atualiza ‚Äúfaixa‚Äù da categoria
    vistaCatLabel.textContent = activeVistaCat ? prettifyName(activeVistaCat) : "Geral";

    let files = [];

    if(activeVistaCat === ""){
      // Geral: PDFs direto na raiz da linha
      const linhaRootNorm = normPath(linhaRoot.replace(/\/+$/,"") + "/");
      files = allPdfPaths.filter(p => {
        const pn = normPath(p);
        if(!pn.startsWith(linhaRootNorm)) return false;
        const rest = pn.slice(linhaRootNorm.length);
        return rest && rest.split("/").length === 1;
      });
    } else {
      const catRoot = `${linhaRoot}/${activeVistaCat}`;
      files = allPdfPaths.filter(p => startsWithFolderLoose(p, catRoot));
    }

    if(query) files = files.filter(p => normPath(p).includes(normPath(query)));
    files.sort((a,b)=>a.localeCompare(b,"pt-BR"));

    const title = activeVistaCat ? `${activeVistaLinha} ‚Ä¢ ${prettifyName(activeVistaCat)}` : `${activeVistaLinha} ‚Ä¢ Geral`;

    content.innerHTML = sectionShell(
      title,
      `${files.length} arquivo(s)`,
      files.length ? `<div class="grid">${files.map(pdfCard).join("")}</div>`
                   : `<div class="empty">Nenhum PDF encontrado nesta sele√ß√£o.</div>`
    );
    return;
  }
}

/** Tabs topo */
tabs.forEach(b=>{
  b.addEventListener("click", ()=>{
    tabs.forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    activeTab = b.dataset.tab;
    render();
  });
});

/** Subtabs boletins */
document.querySelectorAll("#boletinsSubtabs .subtab").forEach(s=>{
  s.addEventListener("click", ()=>{
    document.querySelectorAll("#boletinsSubtabs .subtab").forEach(x=>x.classList.remove("active"));
    s.classList.add("active");
    activeBoletimSub = s.dataset.sub;
    render();
  });
});

/** Busca */
q.addEventListener("input", ()=>render());

render();
</script>
</body>
</html>
