<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portal de Documentos</title>

  <style>
    :root{
      /* Azul Tramontina (mais claro/limpo) */
      --t1:#003087;   /* azul principal */
      --t2:#1f5fe0;   /* azul mais vivo para gradiente */
      --bg:#f3f6ff;   /* fundo claro */
      --ink:#0b1220;  /* texto escuro */

      --muted:#5b6b85;
      --line: rgba(0,0,0,.10);

      --card:#ffffff;
      --shadow: 0 12px 28px rgba(0,0,0,.14);
      --radius: 16px;

      --btn: var(--t1);
      --btn2:#0b3b8f;

      --wa:#22c55e;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--ink);
      background:
        radial-gradient(900px 420px at 20% -10%, rgba(31,95,224,.18), transparent 55%),
        radial-gradient(800px 420px at 90% 0%, rgba(0,48,135,.12), transparent 55%),
        linear-gradient(180deg, #ffffff, var(--bg));
    }

    /* Header */
    header{
      position: sticky;
      top: 0;
      z-index: 50;
      background: linear-gradient(90deg, rgba(0,48,135,.96), rgba(31,95,224,.92));
      color: #fff;
      border-bottom: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(10px);
    }

    .wrap{max-width:1100px;margin:0 auto;padding:16px}

    .top{
      display:flex;
      align-items:center;
      gap:12px;
      padding: 14px 16px 10px;
    }
    .logo-mini{
      width:42px;height:42px;border-radius:16px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.18);
      font-size: 18px;
      flex:0 0 auto;
    }
    h1{margin:0;font-size:18px;font-weight:900;letter-spacing:.2px}

    .controls{padding: 0 16px 12px;}
    .controls input{
      width:100%;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.14);
      color:#fff;
      padding: 12px 14px;
      border-radius: 14px;
      outline:none;
    }
    .controls input::placeholder{color: rgba(255,255,255,.80);}

    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      padding: 0 16px 14px;
    }
    .tab{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.12);
      color:#fff;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 850;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      background: rgba(255,255,255,.22);
      border-color: rgba(255,255,255,.30);
    }

    /* Main scroll area */
    main.wrap{
      height: calc(100vh - 168px);
      overflow:auto;
      padding-top: 14px;
    }

    /* Sections (PDF tabs) */
    .section{
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      overflow: hidden;
    }
    .section-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      background: rgba(255,255,255,.60);
    }
    .section h2{
      margin:0;
      font-size:16px;
      font-weight: 900;
    }
    .count{font-size:12px;color: var(--muted);white-space:nowrap}

    /* Grid + cards */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
      padding: 14px;
    }
    .card{
      grid-column: span 12;
      background: var(--card);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    @media (min-width:760px){ .card{grid-column: span 6;} }
    @media (min-width:1050px){ .card{grid-column: span 4;} }

    .icon{
      width:42px;height:42px;border-radius:16px;
      display:grid;place-items:center;
      background: rgba(0,48,135,.10);
      border: 1px solid rgba(0,48,135,.18);
      font-size: 18px;
      flex:0 0 auto;
    }
    .meta{flex:1;min-width:0}
    .title{
      margin:0 0 6px;
      font-size:14px;
      font-weight: 950;
      line-height:1.25;
      word-break:break-word;
    }
    .small{margin:0;color: var(--muted);font-size:12px}

    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .btn{
      border: 0;
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 900;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      min-width: 132px;
      user-select:none;
    }
    .btn.primary{background: var(--btn); color:#fff;}
    .btn.secondary{background: rgba(0,0,0,.06); color: var(--ink); border:1px solid rgba(0,0,0,.10); min-width:auto;}
    .btn.wa{background: var(--wa); color:#fff;}
    .btn:active{transform: translateY(1px);}

    footer{
      padding: 12px 16px;
      text-align:center;
      font-size:12px;
      color: var(--muted);
    }

    /* ===== PDF Modal ===== */
    .overlay{
      position: fixed;
      inset: 0;
      z-index: 200;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,.50);
      padding: 14px;
    }
    .modal{
      width: min(1100px, 100%);
      height: min(86vh, 900px);
      background: #fff;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
    }
    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px 14px;
      background: linear-gradient(90deg, rgba(0,48,135,.96), rgba(31,95,224,.92));
      color:#fff;
    }
    .modal-title{
      font-weight: 900;
      font-size: 13px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .modal-actions{display:flex;gap:8px;align-items:center;}
    .modal-actions .btn{
      padding: 8px 10px;
      border-radius: 12px;
      min-width: auto;
    }
    .modal-body{flex:1;background:#fff;}
    .modal-body iframe{
      width:100%;
      height:100%;
      border:0;
      background:#fff;
    }

    /* ===== Contato Modal ===== */
    .contact-overlay{
      position:fixed; inset:0; z-index:220;
      display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,.50);
      padding: 14px;
    }
    .contact-modal{
      width: min(720px, 100%);
      background:#fff;
      border-radius: 16px;
      overflow:hidden;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,.08);
    }
    .contact-modal .h{
      padding: 14px 16px;
      background: linear-gradient(90deg, rgba(0,48,135,.96), rgba(31,95,224,.92));
      color:#fff;
      font-weight: 950;
      font-size: 16px;
    }
    .contact-modal .b{
      padding: 14px 16px;
      font-size: 14px;
      line-height: 1.45;
      color: var(--ink);
    }
    .contact-modal .f{
      padding: 14px 16px;
      border-top: 1px solid rgba(0,0,0,.08);
    }
    .contact-modal .f .btn{
      width:100%;
      background: var(--btn2);
      color:#fff;
      border:0;
    }

    /* ===== CANAIS (layout igual ao exemplo) ===== */
    .canais-wrap{max-width:1100px;margin:0 auto;padding: 8px 0 16px;}
    .canais-hero{text-align:center;padding: 8px 12px 10px;}
    .canais-logo{
      display:flex;
      justify-content:center;
      align-items:center;
      padding-top: 8px;
    }
    .canais-logo img{
      height: 60px;
      width:auto;
      display:block;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,.18));
    }
    .canais-title{
      margin: 10px 0 6px;
      font-size: 20px;
      font-weight: 950;
      color: var(--ink);
    }
    .canais-subtitle{
      margin: 0;
      font-size: 14px;
      color: var(--muted);
    }

    .canais-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      padding: 12px 14px 0;
    }
    @media (min-width:760px){ .canais-grid{grid-template-columns:1fr 1fr;} }
    @media (min-width:1050px){ .canais-grid{grid-template-columns:1fr 1fr 1fr;} }

    .canais-card{
      background:#fff;
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 12px 26px rgba(0,0,0,.14);
      border: 1px solid rgba(0,0,0,.06);
      color: var(--ink);
    }
    .canais-card h3{
      margin:0 0 10px;
      font-size: 20px;
      font-weight: 950;
    }
    .canais-card p{
      margin: 6px 0;
      font-size: 14px;
      line-height: 1.35;
      color: rgba(11,18,32,.78);
    }
    .canais-actions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 14px;
    }
    .canais-btn{
      border:0;
      border-radius: 12px;
      padding: 12px 12px;
      font-weight: 950;
      cursor: pointer;
      text-decoration:none;
      text-align:center;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }
    .canais-btn.wa{ background: var(--wa); color:#fff; }
    .canais-btn.info{ background: var(--btn2); color:#fff; }
  </style>
</head>

<body>
<header>
  <div class="top">
    <div class="logo-mini">üìÅ</div>
    <h1>Portal de Documentos</h1>
  </div>

  <div class="controls">
    <input id="q" placeholder="Buscar por nome..." />
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="ordens">Ordens de Servi√ßo</button>
    <button class="tab" data-tab="boletins">Boletins</button>
    <button class="tab" data-tab="canais">Canais</button>
  </div>
</header>

<main class="wrap">
  <div id="content"></div>
</main>

<footer>
  Para adicionar PDFs: envie arquivos para as pastas do reposit√≥rio (o portal lista automaticamente).
</footer>

<!-- PDF VIEWER MODAL -->
<div id="pdfOverlay" class="overlay" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="pdfTitle">Visualizar PDF</div>
      <div class="modal-actions">
        <a class="btn secondary" id="pdfOpenNew" target="_blank" rel="noopener">Abrir em nova guia</a>
        <button class="btn secondary" onclick="closePdf()">Fechar</button>
      </div>
    </div>
    <div class="modal-body">
      <iframe id="pdfFrame" title="Visualizador de PDF"></iframe>
    </div>
  </div>
</div>

<!-- CONTATO MODAL -->
<div id="modalOverlay" class="contact-overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="contact-modal">
    <div class="h"><span id="modalTitle">Informa√ß√µes de Contato</span></div>
    <div class="b"><div id="modalContent"></div></div>
    <div class="f"><button class="btn" onclick="closeModal()">Fechar</button></div>
  </div>
</div>

<script>
/** ====== CONFIG DO SEU REPO ====== */
const OWNER  = "danielzavalhia-commits";
const REPO   = "dani2";
const BRANCH = "main";

/** Pastas base (listagem autom√°tica + subpastas) */
const SECTIONS = {
  ordens: [
    { label: "Ordens de Servi√ßo", root: "ordens_servico" }
  ],
  boletins: [
    { label: "Boletins T√©cnicos", root: "boletins/tecnicos" },
    { label: "Boletins M√£o de Obra", root: "boletins/mao_de_obra" }
  ]
};

/** Dados da aba Canais */
const CANAIS = [
  { nome:"Tha√≠s", funcao:"Atendimento ‚Äì Abertura de OS (Manuten√ß√£o)", email:"atendimentocozinhas.far@tramontina.com", tel:"+55 (54) 98153-6033", wa:"https://wa.me/5554981536033" },
  { nome:"Adalberto", funcao:"Suporte T√©cnico ‚Äì OS (Manuten√ß√£o)", email:"adalberto.souto@tramontina.com", tel:"+55 (54) 99243-7971", wa:"https://wa.me/5554992437971" },
  { nome:"Patr√≠cia", funcao:"Atendimento ‚Äì OS (Instala√ß√£o)", email:"atendimentocozinhas.far@tramontina.com", tel:"+55 (54) 99140-5949", wa:"https://wa.me/5554991405949" },
  { nome:"Mauricio", funcao:"Suporte T√©cnico ‚Äì OS (Instala√ß√£o)", email:"mauricio.lima@tramontina.com", tel:"+55 (54) 99205-7821", wa:"https://wa.me/5554992057821" },
  { nome:"Lucas", funcao:"Promotor T√©cnico ‚Äì Regi√µes Sudeste e Nordeste", email:"lucas.bin@tramontina.com", tel:"+55 (54) 98153-6011", wa:"https://wa.me/5554981536011" },
  { nome:"Rafael", funcao:"Promotor T√©cnico ‚Äì Regi√µes Sul, Centro-Oeste e Norte", email:"rafael.silva@tramontina.com", tel:"+55 (54) 99101-2025", wa:"https://wa.me/5554991012025" },
  { nome:"Robson", funcao:"Suporte T√©cnico ‚Äì S√£o Paulo (SP)", email:"robson.menezes@tramontina.com", tel:"+55 (11) 96171-8289", wa:"https://wa.me/5511961718289" },
  { nome:"Josu√©", funcao:"Promotor T√©cnico ‚Äì S√£o Paulo (SP)", email:"josue.rocha@tramontina.com", tel:"+55 (11) 91499-5839", wa:"https://wa.me/5511914995839" }
];

/** UI */
const content = document.getElementById("content");
const tabs = [...document.querySelectorAll(".tab")];
const q = document.getElementById("q");
let activeTab = "ordens";

/** Helpers */
function isPdf(path){ return path.toLowerCase().endsWith(".pdf"); }
function startsWithFolder(filePath, folderRoot){
  const a = filePath.replace(/^\/+/,"");
  const b = folderRoot.replace(/^\/+/,"").replace(/\/+$/,"");
  return a === b || a.startsWith(b + "/");
}
function prettify(path){
  const name = path.split("/").pop() || path;
  const base = name.replace(/\.[^/.]+$/, "");
  return base
    .replace(/[_-]+/g," ")
    .replace(/\s+/g," ")
    .trim()
    .replace(/\b\w/g, c=>c.toUpperCase());
}
function pageHrefFor(filePath){
  return new URL(filePath.replace(/^\/+/,""), window.location.href).href;
}

/** Tree cache */
let TREE = null;

async function getBranchSha(){
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/branches/${BRANCH}`;
  const res = await fetch(url, { headers: { "Accept":"application/vnd.github+json" }});
  if(!res.ok) throw new Error(`N√£o consegui ler a branch ${BRANCH} (HTTP ${res.status}).`);
  const data = await res.json();
  return data?.commit?.sha;
}

async function getRepoTree(){
  if(TREE) return TREE;
  const sha = await getBranchSha();
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/git/trees/${sha}?recursive=1`;
  const res = await fetch(url, { headers: { "Accept":"application/vnd.github+json" }});
  if(!res.ok) throw new Error(`N√£o consegui listar os arquivos (HTTP ${res.status}).`);
  const data = await res.json();
  TREE = (data.tree || [])
    .filter(x => x.type === "blob")
    .map(x => x.path)
    .filter(isPdf);
  return TREE;
}

/** PDF modal */
function openPdf(title, url){
  document.getElementById("pdfTitle").textContent = title;
  document.getElementById("pdfOpenNew").href = url;

  // tenta abrir inline; se o navegador baixar, o link ‚ÄúAbrir em nova guia‚Äù resolve
  document.getElementById("pdfFrame").src = url + "#view=FitH";
  document.getElementById("pdfOverlay").style.display = "flex";
}
function closePdf(){
  document.getElementById("pdfOverlay").style.display = "none";
  document.getElementById("pdfFrame").src = "about:blank";
}
document.getElementById("pdfOverlay").addEventListener("click", (e)=>{
  if(e.target.id === "pdfOverlay") closePdf();
});

/** Contato modal */
function showContact(name, role, email, phone) {
  document.getElementById('modalContent').innerHTML =
    '<b>Nome:</b> ' + name +
    '<br><b>Fun√ß√£o:</b> ' + role +
    '<br><b>E-mail:</b> ' + email +
    '<br><b>Telefone:</b> ' + phone;

  document.getElementById('modalOverlay').style.display = 'flex';
}
function closeModal() {
  document.getElementById('modalOverlay').style.display = 'none';
}
document.getElementById("modalOverlay").addEventListener("click", (e)=>{
  if(e.target.id === "modalOverlay") closeModal();
});
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape"){
    closePdf();
    closeModal();
  }
});

/* CORRE√á√ÉO: evita quebrar com acentos/travess√£o */
function openContact(el){
  const nome = el.dataset.nome;
  const funcao = el.dataset.funcao;
  const email = el.dataset.email;
  const tel = el.dataset.tel;
  showContact(nome, funcao, email, tel);
}

/** Render pieces */
function sectionShell(title, countText, innerHtml){
  return `
    <section class="section">
      <div class="section-head">
        <h2>${title}</h2>
        <div class="count">${countText || ""}</div>
      </div>
      ${innerHtml}
    </section>
  `;
}

function pdfCard(filePath){
  const title = prettify(filePath);
  const url = pageHrefFor(filePath);
  return `
    <div class="card">
      <div class="icon">üìÑ</div>
      <div class="meta">
        <p class="title">${title}</p>
        <p class="small">PDF</p>
        <div class="actions">
          <button class="btn primary" onclick="openPdf(${JSON.stringify(title)}, ${JSON.stringify(url)})">Visualizar</button>
          <a class="btn secondary" href="${url}" target="_blank" rel="noopener">Nova guia</a>
        </div>
      </div>
    </div>
  `;
}

function canaisHtml(filtered){
  return `
    <div class="canais-wrap">
      <div class="canais-hero">
        <div class="canais-logo">
          <img src="assets/logo_tramontina.png" alt="Tramontina" />
        </div>
        <div class="canais-title">Canais de Atendimento ‚Äì Tramontina Profissional | Farroupilha</div>
        <div class="canais-subtitle">Ordens de Servi√ßo ‚Ä¢ Suporte T√©cnico ‚Ä¢ Promotores T√©cnicos</div>
      </div>

      <div class="canais-grid">
        ${filtered.map(c => `
          <div class="canais-card">
            <h3>${c.nome}</h3>
            <p>${c.funcao}</p>
            <p><b>E-mail:</b> ${c.email}</p>
            <div class="canais-actions">
              <a class="canais-btn wa" target="_blank" rel="noopener" href="${c.wa}">WhatsApp</a>
              <button class="canais-btn info"
                data-nome="${escapeHtml(c.nome)}"
                data-funcao="${escapeHtml(c.funcao)}"
                data-email="${escapeHtml(c.email)}"
                data-tel="${escapeHtml(c.tel)}"
                onclick="openContact(this)">
                Mostrar contato
              </button>
            </div>
          </div>
        `).join("")}
      </div>
    </div>
  `;
}

/* evita quebrar atributo HTML */
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#39;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

/** Main render */
async function render(){
  const query = (q.value || "").trim().toLowerCase();

  // CANAIS
  if(activeTab === "canais"){
    const filtered = CANAIS.filter(c => {
      if(!query) return true;
      return (c.nome + " " + c.funcao + " " + c.email).toLowerCase().includes(query);
    });
    content.innerHTML = canaisHtml(filtered);
    return;
  }

  // PDFs
  let allPdfs = [];
  try{
    allPdfs = await getRepoTree();
  }catch(e){
    content.innerHTML = sectionShell("Erro", "", `<div class="grid"><div class="card"><div class="meta"><p class="title">Erro ao listar arquivos</p><p class="small">${escapeHtml(e.message || String(e))}</p></div></div></div>`);
    return;
  }

  const sections = SECTIONS[activeTab] || [];
  let html = "";

  for(const sec of sections){
    const root = sec.root.replace(/\/+$/,"");
    let files = allPdfs.filter(p => startsWithFolder(p, root));
    if(query) files = files.filter(p => p.toLowerCase().includes(query));
    files.sort((a,b)=>a.localeCompare(b,"pt-BR"));

    const cards = files.length
      ? `<div class="grid">${files.map(pdfCard).join("")}</div>`
      : `<div class="grid"><div class="card"><div class="meta"><p class="title">Nenhum PDF encontrado</p><p class="small">Verifique se existem arquivos em <b>${escapeHtml(root)}</b>.</p></div></div></div>`;

    html += sectionShell(sec.label, `${files.length} arquivo(s)`, cards);
  }

  content.innerHTML = html || sectionShell("Sem conte√∫do", "", "");
}

/** Tabs */
tabs.forEach(t=>{
  t.addEventListener("click", ()=>{
    tabs.forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    activeTab = t.dataset.tab;
    render();
  });
});

/** Busca */
q.addEventListener("input", ()=>render());

render();
</script>
</body>
</html>
